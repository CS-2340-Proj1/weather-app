{% extends 'base.html' %}
{% block content %}
<style>
  .weather-icon {
    width: 48px;
    height: 48px;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    display: block;
    margin: 0 auto 0.5rem;
  }
</style>

<div class="container p-3">
  <h2>7-Day Forecast</h2>

  <div class="mb-3">
    <a
      href="{% url 'weather.forecast' %}?zip_code={{ zip_code }}&unit={{ unit }}"
      class="btn btn-primary me-2"
    >
      7-Day Forecast
    </a>
    {% if user.is_authenticated %}
      <a
        href="{% url 'weather.summary' %}?zip_code={{ zip_code }}&unit={{ unit }}"
        class="btn btn-outline-primary"
      >
        Today's AI Summary
      </a>
    {% else %}
      <a
        class="btn btn-outline-primary disabled"
        aria-disabled="true"
        title="Log in to see summary"
      >
        Today's AI Summary
      </a>
    {% endif %}
  </div>

  <form method="get" class="mb-3 d-flex">
    <input
      id="zip_input"
      name="zip_code"
      type="text"
      class="form-control me-2"
      placeholder="Enter zip code"
      value="{{ zip_code|default_if_none:'' }}"
      onfocus="this.select();"
    />
    <input type="hidden" name="unit" value="{{ unit }}" />
    <button class="btn btn-dark">Get Forecast</button>
  </form>

  {% if error_message %}
    <div class="alert alert-danger">{{ error_message }}</div>
  {% endif %}

  {% if forecast_data %}
    <div class="row">
      {% for day in forecast_data %}
        <div class="col-md-4 mb-4">
          <div class="card text-center h-100 p-2">
            <h5>{{ day.name }}</h5>
            {% with desc=day.shortForecast|lower %}
  {% if 'sun' in desc and not 'rain' in desc %}
    <img
      src="https://img.icons8.com/ios/48/000000/sun--v1.png"
      alt="{{ day.shortForecast }}"
      class="weather-icon"
    />
  {% elif 'cloud' in desc and 'sun' in desc %}
    <img
      src="https://img.icons8.com/ios/48/000000/partly-cloudy-day.png"
      alt="{{ day.shortForecast }}"
      class="weather-icon"
    />
  {% elif 'cloud' in desc %}
    <img
      src="https://img.icons8.com/ios/48/000000/cloud.png"
      alt="{{ day.shortForecast }}"
      class="weather-icon"
    />
  {% elif 'rain' in desc %}
    <img
      src="https://img.icons8.com/ios/48/000000/rain.png"
      alt="{{ day.shortForecast }}"
      class="weather-icon"
    />
  {% elif 'snow' in desc %}
    <img
      src="https://img.icons8.com/ios/48/000000/snow.png"
      alt="{{ day.shortForecast }}"
      class="weather-icon"
    />
  {% elif 'thunder' in desc %}
    <img
      src="https://img.icons8.com/ios/48/000000/storm.png"
      alt="{{ day.shortForecast }}"
      class="weather-icon"
    />
  {% else %}
    <img
      src="https://img.icons8.com/ios/48/000000/weather.png"
      alt="{{ day.shortForecast }}"
      class="weather-icon"
    />
  {% endif %}
{% endwith %}

            <p class="mt-2">{{ day.shortForecast }}</p>
            <p>Temp: {{ day.temperature }}Â° {{ day.temperatureUnit }}</p>
            <p>{{ day.detailedForecast }}</p>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock content %}
{% block extra_js %}{% endblock extra_js %}
